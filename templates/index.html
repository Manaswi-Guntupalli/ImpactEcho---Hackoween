<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ImpactEcho â€” Trust-First Fundraising</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3EðŸ”Š%3C/text%3E%3C/svg%3E">
<style>
  :root{
    --bg: #f6f8fb;
    --card: #ffffff;
    --muted: #6b7280;
    --primary: #375aeb;
    --accent: #e9f0ff;
    --radius: 14px;
    --shadow: 0 10px 30px rgba(17,24,39,0.08);
  }
  *{box-sizing:border-box;}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,-apple-system,Arial;}
  body{
    background: linear-gradient(180deg,#f3f7ff 0%,var(--bg) 100%);
    color:#0f172a;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    min-height:100vh;
    -webkit-font-smoothing:antialiased;
  }

  /* Navbar */
  nav{
    position:fixed;top:0;left:0;width:100%;
    background:var(--card);
    box-shadow:0 2px 10px rgba(0,0,0,0.05);
    display:flex;justify-content:center;gap:40px;
    padding:16px 0;z-index:50;
  }
  nav button{
    background:none;border:none;cursor:pointer;
    font-weight:700;font-size:15px;color:var(--muted);
    transition:color 0.2s, border-bottom 0.2s;
    border-bottom:2px solid transparent;
  }
  nav button.active{
    color:var(--primary);
    border-bottom:2px solid var(--primary);
  }

  /* Layout */
  main{
    margin-top:90px;
    width:100%;
    display:flex;
    justify-content:center;
    align-items:center;
  }

  .page{
    display:none;
    width:100%;
    max-width:1100px;
    margin:0 auto;
    padding:28px;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    text-align:center;
    gap:20px;
    animation:fadeIn 0.4s ease;
  }
  .page.active{
    display:flex;
  }

  @keyframes fadeIn{
    from{opacity:0;transform:translateY(10px);}
    to{opacity:1;transform:translateY(0);}
  }

  h1{margin:0;font-size:30px;line-height:1.05;}
  p.lead{margin:0;color:var(--muted);font-size:15px;}

  /* Card */
  .card{
    width:420px;background:var(--card);border-radius:16px;padding:20px;box-shadow:var(--shadow);
    border:1px solid rgba(13,18,32,0.04);
    display:flex;flex-direction:column;gap:12px;
  }

  .title{font-weight:800;font-size:16px;}
  .wallet-info{display:flex;align-items:center;gap:12px;justify-content:center;}
  .dot{width:10px;height:10px;border-radius:50%;background:#F87171;}
  .addr{font-weight:700;}

  .cta{margin-top:8px;display:flex;gap:10px;justify-content:center;}
  .btn{
    border:0;padding:10px 14px;border-radius:10px;font-weight:800;cursor:pointer;
  }
  .btn.primary{background:linear-gradient(90deg,var(--primary),#5b78ff);color:white;box-shadow:0 10px 24px rgba(55,90,235,0.18);}
  .btn.ghost{background:transparent;border:1px solid rgba(13,18,32,0.06);}
  .footnote{font-size:13px;color:var(--muted);margin-top:8px;}

  @media(max-width:920px){
    .card{width:100%;}
  }
</style>
</head>
<body>

<!-- Navbar -->
<nav>
  <button id="tab-home" class="active">Home</button>
  <button id="tab-about">About</button>
  <button id="tab-contact">Contact</button>
</nav>

<main>
  <!-- HOME PAGE -->
  <section id="home" class="page active">
    <div class="logo" style="width:70px;height:70px;border-radius:16px;background:linear-gradient(135deg,#3b82f6,#7c5cff);display:flex;align-items:center;justify-content:center;color:white;font-weight:900;font-size:26px;box-shadow:0 12px 30px rgba(59,130,246,0.18)">IE</div>
    <h1>ImpactEcho â€” Trust-First Fundraising</h1>
    <p class="lead">Create or support campaigns with wallet-backed trust.<br>Connect your wallet to enter your personal dashboard.</p>

    <aside class="card" aria-label="Connect wallet">
      <div class="title">Enter your ImpactEcho dashboard</div>
      <div class="small-muted">Connect with MetaMask. We'll generate a secure session hash and take you to your dashboard.</div>

      <div class="wallet-info" role="status" aria-live="polite">
        <div class="dot" id="statusDot" title="connection status"></div>
        <div>
          <div class="small-muted">Wallet</div>
          <div id="walletAddr" class="addr">Not connected</div>
        </div>
      </div>

      <div class="cta">
        <button id="connectBtn" class="btn primary">Connect MetaMask</button>
        <button id="generateBtn" class="btn ghost" disabled>Generate & Enter</button>
      </div>

      <p class="footnote">Already signed in? Connect the same wallet to go directly to your dashboard.</p>
    </aside>
  </section>

  <!-- ABOUT PAGE -->
  <section id="about" class="page">
    <h1>About ImpactEcho</h1>
    <p class="lead">ImpactEcho is a decentralized, trust-driven fundraising platform.<br>
      We verify fundraisers via blockchain-linked identities and track every donation transparently.<br><br>
      Unlike traditional crowdfunding, our focus is on <strong>who is fundraising</strong>, not just who receives funds.
      Each donor and fundraiser interaction is secured via cryptographic session hashes to ensure accountability and traceability.</p>
  </section>

  <!-- CONTACT PAGE -->
  <section id="contact" class="page">
    <h1>Contact Us</h1>
    <p class="lead">Have a question or partnership idea?<br>Reach out to us:</p>
    <p><strong>Email:</strong> hello@impactecho.org<br>
       <strong>Twitter:</strong> @ImpactEcho<br>
       <strong>Location:</strong> Bengaluru, India</p>
  </section>
</main>

<script>
/* ---- TAB SWITCHING ---- */
const tabs = { home: document.getElementById('home'), about: document.getElementById('about'), contact: document.getElementById('contact') };
const navButtons = { home: document.getElementById('tab-home'), about: document.getElementById('tab-about'), contact: document.getElementById('tab-contact') };
Object.keys(navButtons).forEach(tab=>{
  navButtons[tab].addEventListener('click',()=>{
    Object.keys(tabs).forEach(t=>{
      tabs[t].classList.remove('active');
      navButtons[t].classList.remove('active');
    });
    tabs[tab].classList.add('active');
    navButtons[tab].classList.add('active');
  });
});

/* ---- MetaMask + Hash Logic ---- */
function shortAddr(addr){return addr?addr.slice(0,6)+'â€¦'+addr.slice(-4):'Not connected';}
function toHex(buffer){return Array.from(new Uint8Array(buffer)).map(b=>b.toString(16).padStart(2,'0')).join('');}
async function sha256Hex(str){const data=new TextEncoder().encode(str);const hash=await crypto.subtle.digest('SHA-256',data);return toHex(hash);}

const connectBtn=document.getElementById('connectBtn');
const generateBtn=document.getElementById('generateBtn');
const walletAddrEl=document.getElementById('walletAddr');
const statusDot=document.getElementById('statusDot');

let currentAccount=null;

async function metamaskAvailable(){return Boolean(window.ethereum && window.ethereum.isMetaMask);}
async function connectWallet(){
  if(!await metamaskAvailable()){
    if(confirm('MetaMask not detected. Install MetaMask?')) window.open('https://metamask.io/download.html','_blank');
    return;
  }
  try{
    const accts=await window.ethereum.request({method:'eth_requestAccounts'});
    handleAccountsChanged(accts);
  }catch(e){alert('Failed to connect: '+(e.message||e));}
}
function handleAccountsChanged(accounts){
  if(!accounts||!accounts.length){
    currentAccount=null;
    walletAddrEl.textContent='Not connected';
    statusDot.style.background='#F87171';
    generateBtn.disabled=true;
  }else{
    currentAccount=accounts[0];
    walletAddrEl.textContent=shortAddr(currentAccount);
    statusDot.style.background='#34D399';
    generateBtn.disabled=false;
  }
}
if(window.ethereum){
  window.ethereum.on?.('accountsChanged',handleAccountsChanged);
  window.ethereum.on?.('chainChanged',()=>location.reload());
}

async function generateSessionHash(){
  if(!currentAccount){alert('Connect MetaMask first.');return;}
  const ts=new Date().toISOString();
  const nonce=crypto.getRandomValues(new Uint32Array(3)).join('-');
  const payload=`${currentAccount}|${ts}|${nonce}`;
  const hash=await sha256Hex(payload);
  return {hash,address:currentAccount,timestamp:ts,nonce};
}

generateBtn.addEventListener('click', async () => {
  if(!currentAccount) return alert('Connect MetaMask first.');
  generateBtn.disabled=true;
  generateBtn.textContent='Generatingâ€¦';
  try{
    const obj = await generateSessionHash();
    // store hash in backend
    const res = await fetch('/api/store-hash', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(obj)
    });
    if(!res.ok) throw new Error('Failed to store hash');

    // âœ… Redirect to /dash instead of old dashboard.html
    location.href = '/dash';
  }catch(e){
    alert('Failed: '+(e.message||e));
  }finally{
    generateBtn.disabled=false;
    generateBtn.textContent='Generate & Enter';
  }
});

connectBtn.addEventListener('click',connectWallet);

(async function init(){
  if(await metamaskAvailable()){
    try{
      const accts=await window.ethereum.request({method:'eth_accounts'});
      if(accts?.length) handleAccountsChanged(accts);
    }catch{}
  }else{
    statusDot.style.background='#FBBF24';
    walletAddrEl.textContent='MetaMask not installed';
    connectBtn.textContent='Install MetaMask';
    connectBtn.addEventListener('click',()=>window.open('https://metamask.io/download.html','_blank'));
  }
})();
</script>
</body>
</html>
